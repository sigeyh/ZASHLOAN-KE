<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Loan Request - Zash Loan</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-red-700 via-red-600 to-red-500 text-white min-h-screen px-4 py-6 font-sans">

  <!-- Header -->
  <div class="flex items-center gap-3 mb-6">
    <img src="zashlogo.jpeg" alt="Zash Logo" class="w-12 h-12 rounded-full">
    <h1 class="text-2xl font-bold">Zash Loan</h1>
  </div>

  <!-- Loan Info -->
  <div class="bg-white bg-opacity-10 p-4 rounded-xl mb-6">
    <h2 class="text-xl font-semibold mb-2">Loan Details</h2>
    <p><strong>Loan Limit:</strong> Ksh <span id="loanLimit">-</span></p>

    <label for="loanAmount" class="block mt-4">Select Loan Amount</label>
    <input type="range" id="loanAmount" min="2500" max="12000" step="100" class="w-full mt-2">
    <p class="mt-1">Amount: Ksh <span id="amountDisplay">-</span></p>

    <label for="dueDate" class="block mt-4">Select Due Date</label>
    <input type="date" id="dueDate" class="w-full mt-1 text-black rounded px-2 py-1">

    <label for="phone" class="block mt-4">M-Pesa Number</label>
    <input type="tel" id="phone" placeholder="07XXXXXXXX" class="w-full mt-1 text-black rounded px-2 py-1">
  </div>

  <!-- Loader -->
  <div id="loader" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50">
    <div class="text-center">
      <svg class="animate-spin h-10 w-10 text-white mx-auto mb-4" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
      </svg>
      <p class="text-white text-lg font-medium">Processing your request...</p>
    </div>
  </div>

  <!-- Continue Button -->
  <button onclick="continueLoan()" class="w-full bg-yellow-400 text-black font-bold py-3 rounded-full hover:bg-yellow-300 shadow-lg">Continue</button>

  <script>
    const data = JSON.parse(localStorage.getItem("loanRequest")) || {};
    const loanLimit = data.loanLimit || Math.floor(Math.random() * (12000 - 2500 + 1)) + 2500;

    document.getElementById("loanLimit").textContent = loanLimit.toLocaleString();
    const amountInput = document.getElementById("loanAmount");
    const amountDisplay = document.getElementById("amountDisplay");

    amountInput.value = loanLimit;
    amountDisplay.textContent = loanLimit.toLocaleString();

    amountInput.addEventListener("input", () => {
      amountDisplay.textContent = amountInput.value;
    });

    function calculateServiceFee(amount) {
      return Math.ceil(amount * 0.062); // 6.2% fee
    }

    function continueLoan() {
      const amount = parseInt(amountInput.value);
      const phone = document.getElementById("phone").value.trim();
      const dueDate = document.getElementById("dueDate").value;

      if (!phone || !dueDate) {
        alert("Please fill in all the fields.");
        return;
      }

      const serviceFee = calculateServiceFee(amount);
      const today = new Date().toISOString().split("T")[0];

      const loanData = {
        amount,
        serviceFee,
        dueDate,
        requestDate: today,
        phone,
        loanLimit
      };

      localStorage.setItem("loanRequest", JSON.stringify(loanData));

      // Show loader and redirect after 3 seconds
      document.getElementById("loader").classList.remove("hidden");
      setTimeout(() => {
        window.location.href = "verification.html";
      }, 3000);
    }
  </script>
</body>
</html>
