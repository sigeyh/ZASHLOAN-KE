<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Apply Loan - Zash Loan</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-red-700 via-red-600 to-red-400 min-h-screen text-white font-sans">

  <!-- Header -->
  <div class="p-4 flex items-center gap-3">
    <img src="zashlogo.jpeg" alt="Zash Logo" class="w-12 h-12 rounded-full object-cover"/>
    <h1 class="text-2xl font-bold">Zash Loan</h1>
  </div>

  <!-- Loan Application Form -->
  <div class="max-w-md mx-auto mt-6 bg-white bg-opacity-10 backdrop-blur-md rounded-xl p-6 space-y-4 shadow-lg">

    <h2 class="text-xl font-semibold text-center">Apply for a Loan</h2>

    <div>
      <label class="block mb-1">Loan Amount (Ksh)</label>
      <input type="range" id="loanSlider" class="w-full" min="1000" max="3500" step="50" />
      <div class="flex justify-between text-sm mt-1">
        <span>Min: 1000</span>
        <span id="maxLimit">Max: 3500</span>
      </div>
      <p class="mt-2">Selected: <span class="font-bold text-yellow-300" id="loanAmount">0</span></p>
    </div>

    <div>
      <label class="block mb-1">Service Fee (6.2%)</label>
      <p class="text-lg font-semibold">Ksh <span id="serviceFee">0</span></p>
    </div>

    <div>
      <label class="block mb-1">Total Repayment</label>
      <p class="text-lg font-bold text-green-300">Ksh <span id="totalRepayment">0</span></p>
    </div>

    <div>
      <label class="block mb-1">M-Pesa Phone Number</label>
      <input type="tel" id="phone" placeholder="e.g. 0712345678" class="w-full px-3 py-2 rounded text-black" />
    </div>

    <div>
      <label class="block mb-1">Select Due Date</label>
      <input type="date" id="dueDate" class="w-full px-3 py-2 rounded text-black" />
    </div>

    <button onclick="submitLoan()" class="w-full bg-yellow-400 text-black font-bold py-2 rounded hover:bg-yellow-300 transition">
      Continue
    </button>

  </div>

  <script>
    const loanSlider = document.getElementById('loanSlider');
    const loanAmountEl = document.getElementById('loanAmount');
    const serviceFeeEl = document.getElementById('serviceFee');
    const totalRepaymentEl = document.getElementById('totalRepayment');
    const maxLimitEl = document.getElementById('maxLimit');

    // Load loan limit from checklimit.html
    const loanData = JSON.parse(localStorage.getItem("loanData")) || {};
    const maxLoan = loanData.amount || 3500;

    loanSlider.max = maxLoan;
    maxLimitEl.innerText = `Max: ${maxLoan}`;

    // Update UI on slider input
    const updateDisplay = () => {
      const amount = parseInt(loanSlider.value);
      const fee = Math.round(amount * 0.062);
      const total = amount + fee;

      loanAmountEl.innerText = amount;
      serviceFeeEl.innerText = fee;
      totalRepaymentEl.innerText = total;
    };

    loanSlider.addEventListener('input', updateDisplay);
    updateDisplay(); // initial call

    function submitLoan() {
      const phone = document.getElementById('phone').value;
      const dueDate = document.getElementById('dueDate').value;
      const amount = parseInt(loanSlider.value);
      const fee = Math.round(amount * 0.062);
      const total = amount + fee;

      if (!phone || !dueDate) {
        alert("Please enter your phone number and due date.");
        return;
      }

      const finalData = {
        amount: amount,
        serviceFee: fee,
        totalRepayment: total,
        phone: phone,
        dueDate: dueDate
      };

      localStorage.setItem("finalLoanData", JSON.stringify(finalData));
      window.location.href = "verification.html";
    }
  </script>

</body>
</html>
